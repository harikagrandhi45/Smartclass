<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Manage Faculty</title>
<style>
  body { font-family: Arial, sans-serif; background:#f9fafb; margin:0; padding:0; }
  h1 { text-align:center; background:#004d40; color:white; padding:40px; margin:0; }
  .container { width:90%; margin:30px auto; }
  a { display:inline-block; margin-bottom:20px; text-decoration:none; color:#004d40; font-weight:bold; }
  .form-section { background:white; padding:20px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.05); margin-bottom:30px; }
  input[type="text"] { padding:8px; margin-right:10px; border:1px solid #ccc; border-radius:6px; font-size:14px; width:250px; }
  button { background:#00796b; color:white; border:none; padding:8px 15px; border-radius:8px; cursor:pointer; font-size:14px; margin:2px; }
  button:hover { background:#00695c; }
  .table-section { background:white; padding:20px; border-radius:12px; box-shadow:0 4px 8px rgba(0,0,0,0.05); }
  table { width:100%; border-collapse:collapse; margin-top:10px; }
  table th, table td { border:1px solid #e0e0e0; padding:10px; text-align:center; font-size:14px; }
  table th { background:#004d40; color:white; }
  .action-btn { background:#0288d1; }
  .action-btn:hover { background:#0277bd; }
  .delete-btn { background:#d32f2f; }
  .delete-btn:hover { background:#b71c1c; }
</style>
</head>
<body>
<h1>Manage Faculty</h1>
<div class="container">
  <a href="index.html">← Back to Dashboard</a>

  <div class="form-section">
    <input type="text" id="facultyName" placeholder="Faculty Name">
    <button id="addFacultyBtn">➕ Add Faculty</button>
  </div>

  <div class="table-section">
    <table id="facultyTable">
      <tr><th>Faculty Name</th><th>Action</th></tr>
    </table>
  </div>
</div>

<script>
const API_BASE = "http://localhost:5000";
const authToken = localStorage.getItem("sc_token") || "";

function authHeaders() {
  const headers = { "Content-Type": "application/json" };
  if (authToken) headers["Authorization"] = "Bearer " + authToken;
  return headers;
}

async function fetchFaculty(){
  try {
    const res = await fetch(`${API_BASE}/faculty`, { headers: authHeaders() });
    if(!res.ok) throw new Error((await res.json()).message || res.statusText);
    const data = await res.json();
    renderFaculty(data);
  } catch (err) {
    alert("Failed to load faculty: " + err.message);
  }
}

function renderFaculty(list){
  const table = document.getElementById("facultyTable");
  table.innerHTML = '<tr><th>Faculty Name</th><th>Action</th></tr>';
  list.forEach(f => {
    table.innerHTML += `<tr>
      <td>${escapeHtml(f.name)}</td>
      <td>
        <button class="action-btn" onclick="editFaculty('${f._id}','${escapeAttr(f.name)}')">Edit</button>
        <button class="delete-btn" onclick="deleteFaculty('${f._id}')">Delete</button>
      </td>
    </tr>`;
  });
}

function escapeHtml(s){ return String(s).replace(/[&<>"']/g, c => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[c])); }
function escapeAttr(s){ return String(s).replace(/'/g,"\\'").replace(/"/g,'\\"'); }

document.getElementById("addFacultyBtn").addEventListener("click", async ()=>{
  const name = document.getElementById("facultyName").value.trim();
  if(!name){ alert("Please enter a faculty name!"); return; }
  try {
    const res = await fetch(`${API_BASE}/faculty`, {
      method: "POST",
      headers: authHeaders(),
      body: JSON.stringify({ name })
    });
    const data = await res.json();
    if(!res.ok) throw new Error(data.message || res.statusText);
    document.getElementById("facultyName").value = "";
    fetchFaculty();
  } catch (err) {
    alert("Add failed: " + err.message);
  }
});

async function editFaculty(id, currentName){
  const newName = prompt("Enter new name:", currentName);
  if(newName === null) return;
  const trimmed = newName.trim();
  if(!trimmed){ alert("Name cannot be empty"); return; }
  try {
    const res = await fetch(`${API_BASE}/faculty/${id}`, {
      method: "PUT",
      headers: authHeaders(),
      body: JSON.stringify({ name: trimmed })
    });
    const data = await res.json();
    if(!res.ok) throw new Error(data.message || res.statusText);
    fetchFaculty();
  } catch (err) {
    alert("Update failed: " + err.message);
  }
}

async function deleteFaculty(id){
  if(!confirm("Are you sure you want to delete this faculty?")) return;
  try {
    const res = await fetch(`${API_BASE}/faculty/${id}`, {
      method: "DELETE",
      headers: authHeaders()
    });
    if(!res.ok) throw new Error((await res.json()).message || res.statusText);
    fetchFaculty();
  } catch (err) {
    alert("Delete failed: " + err.message);
  }
}

// initial load
fetchFaculty();
</script>
</body>
</html>
